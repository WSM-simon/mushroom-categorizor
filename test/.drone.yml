kind: pipeline
type: docker
name: test_pipeline

trigger:
  event: [ push ]
  branch: [ main ]

steps:
  # Simple test step - just verify files exist
  - name: test-files
    image: alpine:latest
    commands:
      - echo "Testing file structure..."
      - ls -lah /drone/src/
      - test -f /drone/src/main.py && echo "✓ main.py exists"
      - test -f /drone/src/mushroom_model.keras && echo "✓ mushroom_model.keras exists"
      - test -f /drone/src/requirements.txt && echo "✓ requirements.txt exists"
      - echo "All files present!"

  # Test requirements.txt syntax
  - name: test-requirements
    image: alpine:latest
    commands:
      - echo "Checking requirements.txt..."
      - head -10 /drone/src/requirements.txt
      - echo "Requirements.txt is valid!"

  # Test Dockerfile syntax (using hadolint if available, or just cat)
  - name: test-dockerfile
    image: alpine:latest
    commands:
      - echo "Checking Dockerfile..."
      - cat /drone/src/test/Dockerfile
      - echo "Dockerfile exists and is readable!"
